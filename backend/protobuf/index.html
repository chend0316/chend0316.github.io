<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Protobuf第三方扩展开发指南 | 陈东的博客</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.491867c0.js" as="script"><link rel="preload" href="/assets/js/2.be1f9426.js" as="script"><link rel="preload" href="/assets/js/3.bddbc11c.js" as="script"><link rel="prefetch" href="/assets/js/10.3c8b706a.js"><link rel="prefetch" href="/assets/js/100.8748b2d9.js"><link rel="prefetch" href="/assets/js/101.d44e6eec.js"><link rel="prefetch" href="/assets/js/102.ce797112.js"><link rel="prefetch" href="/assets/js/103.f20f8d41.js"><link rel="prefetch" href="/assets/js/104.c4b00b56.js"><link rel="prefetch" href="/assets/js/105.cf4687eb.js"><link rel="prefetch" href="/assets/js/11.7277aa9e.js"><link rel="prefetch" href="/assets/js/12.db09e7d7.js"><link rel="prefetch" href="/assets/js/13.7241bd32.js"><link rel="prefetch" href="/assets/js/14.6017adb6.js"><link rel="prefetch" href="/assets/js/15.2636bcb0.js"><link rel="prefetch" href="/assets/js/16.c030ab23.js"><link rel="prefetch" href="/assets/js/17.8eb18d91.js"><link rel="prefetch" href="/assets/js/18.5600d234.js"><link rel="prefetch" href="/assets/js/19.e407fbd9.js"><link rel="prefetch" href="/assets/js/20.429def32.js"><link rel="prefetch" href="/assets/js/21.6df5ae48.js"><link rel="prefetch" href="/assets/js/22.22025ef4.js"><link rel="prefetch" href="/assets/js/23.8de15994.js"><link rel="prefetch" href="/assets/js/24.f455769e.js"><link rel="prefetch" href="/assets/js/25.078c7c02.js"><link rel="prefetch" href="/assets/js/26.3818f22b.js"><link rel="prefetch" href="/assets/js/27.d11da0a5.js"><link rel="prefetch" href="/assets/js/28.06cb3c69.js"><link rel="prefetch" href="/assets/js/29.015b99d7.js"><link rel="prefetch" href="/assets/js/30.7d1e8e08.js"><link rel="prefetch" href="/assets/js/31.6bd2ba2a.js"><link rel="prefetch" href="/assets/js/32.28953dd2.js"><link rel="prefetch" href="/assets/js/33.b8e2c294.js"><link rel="prefetch" href="/assets/js/34.ed092483.js"><link rel="prefetch" href="/assets/js/35.b2d4a119.js"><link rel="prefetch" href="/assets/js/36.f21f7d28.js"><link rel="prefetch" href="/assets/js/37.93cdf2bf.js"><link rel="prefetch" href="/assets/js/38.d4eb9d5e.js"><link rel="prefetch" href="/assets/js/39.221240e4.js"><link rel="prefetch" href="/assets/js/4.59240635.js"><link rel="prefetch" href="/assets/js/40.9603ee99.js"><link rel="prefetch" href="/assets/js/41.183bf282.js"><link rel="prefetch" href="/assets/js/42.a07dbf06.js"><link rel="prefetch" href="/assets/js/43.9b550e13.js"><link rel="prefetch" href="/assets/js/44.e0e0cc07.js"><link rel="prefetch" href="/assets/js/45.d9bceda6.js"><link rel="prefetch" href="/assets/js/46.cf215b69.js"><link rel="prefetch" href="/assets/js/47.c3af69cc.js"><link rel="prefetch" href="/assets/js/48.78254a5d.js"><link rel="prefetch" href="/assets/js/49.eede8840.js"><link rel="prefetch" href="/assets/js/5.3614312d.js"><link rel="prefetch" href="/assets/js/50.87b6a500.js"><link rel="prefetch" href="/assets/js/51.d6978781.js"><link rel="prefetch" href="/assets/js/52.85db969b.js"><link rel="prefetch" href="/assets/js/53.8f96479c.js"><link rel="prefetch" href="/assets/js/54.2df7b633.js"><link rel="prefetch" href="/assets/js/55.253861a9.js"><link rel="prefetch" href="/assets/js/56.f5108d90.js"><link rel="prefetch" href="/assets/js/57.196535e5.js"><link rel="prefetch" href="/assets/js/58.df1cf7c2.js"><link rel="prefetch" href="/assets/js/59.abf650e4.js"><link rel="prefetch" href="/assets/js/6.44b0d8ee.js"><link rel="prefetch" href="/assets/js/60.6502a6da.js"><link rel="prefetch" href="/assets/js/61.f203210e.js"><link rel="prefetch" href="/assets/js/62.da4bb07b.js"><link rel="prefetch" href="/assets/js/63.d5de9af0.js"><link rel="prefetch" href="/assets/js/64.25624999.js"><link rel="prefetch" href="/assets/js/65.367c7d27.js"><link rel="prefetch" href="/assets/js/66.5cee8445.js"><link rel="prefetch" href="/assets/js/67.107ed085.js"><link rel="prefetch" href="/assets/js/68.324c2c85.js"><link rel="prefetch" href="/assets/js/69.8c255f56.js"><link rel="prefetch" href="/assets/js/7.754a1091.js"><link rel="prefetch" href="/assets/js/70.b0e98f30.js"><link rel="prefetch" href="/assets/js/71.6ab748cd.js"><link rel="prefetch" href="/assets/js/72.b6518337.js"><link rel="prefetch" href="/assets/js/73.2afdc022.js"><link rel="prefetch" href="/assets/js/74.c0a1fc7b.js"><link rel="prefetch" href="/assets/js/75.9e032cdb.js"><link rel="prefetch" href="/assets/js/76.4ff2cda9.js"><link rel="prefetch" href="/assets/js/77.eeb69dd5.js"><link rel="prefetch" href="/assets/js/78.53b22f78.js"><link rel="prefetch" href="/assets/js/79.c8dccb9c.js"><link rel="prefetch" href="/assets/js/8.c9fab24e.js"><link rel="prefetch" href="/assets/js/80.3b682200.js"><link rel="prefetch" href="/assets/js/81.75031340.js"><link rel="prefetch" href="/assets/js/82.abc5718a.js"><link rel="prefetch" href="/assets/js/83.fe7421bf.js"><link rel="prefetch" href="/assets/js/84.182f61cc.js"><link rel="prefetch" href="/assets/js/85.375e5725.js"><link rel="prefetch" href="/assets/js/86.c9265cba.js"><link rel="prefetch" href="/assets/js/87.cee386f6.js"><link rel="prefetch" href="/assets/js/88.0fd81384.js"><link rel="prefetch" href="/assets/js/89.5c3cf635.js"><link rel="prefetch" href="/assets/js/9.9d3c91bc.js"><link rel="prefetch" href="/assets/js/90.330fc479.js"><link rel="prefetch" href="/assets/js/91.33a184c2.js"><link rel="prefetch" href="/assets/js/92.e427efd9.js"><link rel="prefetch" href="/assets/js/93.4e82abf4.js"><link rel="prefetch" href="/assets/js/94.5aed9a95.js"><link rel="prefetch" href="/assets/js/95.2f3210da.js"><link rel="prefetch" href="/assets/js/96.b41ad869.js"><link rel="prefetch" href="/assets/js/97.2bbeadea.js"><link rel="prefetch" href="/assets/js/98.18dfa3ed.js"><link rel="prefetch" href="/assets/js/99.f7b01a36.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">陈东的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="力扣刷题" class="dropdown-title"><span class="title">力扣刷题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetcode/code-template.html" class="nav-link">
  代码模板 (背)
</a></li><li class="dropdown-item"><!----> <a href="/leetcode/lang-diff.html" class="nav-link">
  语言差异 (坑)
</a></li><li class="dropdown-item"><!----> <a href="/leetcode/diary.html" class="nav-link">
  我的刷题日记
</a></li><li class="dropdown-item"><h4>
          专题讲解
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/leetcode/topic/search.html" class="nav-link">
  搜索
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/dp.html" class="nav-link">
  DP
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/bin-search.html" class="nav-link">
  二分查找
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/data-structure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/topk.html" class="nav-link">
  TopK
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/others.html" class="nav-link">
  其它
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基本功
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/browser/" class="nav-link">
  浏览器和网络
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/frontend/framework/" class="nav-link">
  原理和思想
</a></li></ul></li><li class="dropdown-item"><h4>
          工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/webpack/" class="nav-link">
  Webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          跨平台
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/mini-program/" class="nav-link">
  微信小程序
</a></li><li class="dropdown-subitem"><a href="/frontend/flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-subitem"><a href="/frontend/electron/" class="nav-link">
  Electron
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/performance/" class="nav-link">
  性能
</a></li><li class="dropdown-subitem"><a href="/frontend/visualization/" class="nav-link">
  可视化
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/cython/" class="nav-link">
  Cython
</a></li><li class="dropdown-item"><!----> <a href="/backend/protobuf/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Protobuf
</a></li><li class="dropdown-item"><!----> <a href="/backend/docker.html" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cs/network/" class="nav-link">
  计算机网络
</a></li></ul></div></div> <a href="https://github.com/chend0316/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="力扣刷题" class="dropdown-title"><span class="title">力扣刷题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetcode/code-template.html" class="nav-link">
  代码模板 (背)
</a></li><li class="dropdown-item"><!----> <a href="/leetcode/lang-diff.html" class="nav-link">
  语言差异 (坑)
</a></li><li class="dropdown-item"><!----> <a href="/leetcode/diary.html" class="nav-link">
  我的刷题日记
</a></li><li class="dropdown-item"><h4>
          专题讲解
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/leetcode/topic/search.html" class="nav-link">
  搜索
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/dp.html" class="nav-link">
  DP
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/bin-search.html" class="nav-link">
  二分查找
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/data-structure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/topk.html" class="nav-link">
  TopK
</a></li><li class="dropdown-subitem"><a href="/leetcode/topic/others.html" class="nav-link">
  其它
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基本功
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/browser/" class="nav-link">
  浏览器和网络
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/frontend/framework/" class="nav-link">
  原理和思想
</a></li></ul></li><li class="dropdown-item"><h4>
          工程化
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/webpack/" class="nav-link">
  Webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          跨平台
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/mini-program/" class="nav-link">
  微信小程序
</a></li><li class="dropdown-subitem"><a href="/frontend/flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-subitem"><a href="/frontend/electron/" class="nav-link">
  Electron
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/performance/" class="nav-link">
  性能
</a></li><li class="dropdown-subitem"><a href="/frontend/visualization/" class="nav-link">
  可视化
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/cython/" class="nav-link">
  Cython
</a></li><li class="dropdown-item"><!----> <a href="/backend/protobuf/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Protobuf
</a></li><li class="dropdown-item"><!----> <a href="/backend/docker.html" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cs/network/" class="nav-link">
  计算机网络
</a></li></ul></div></div> <a href="https://github.com/chend0316/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/backend/cython/" class="sidebar-link">Cython入门教程</a></li><li><a href="/backend/protobuf/" aria-current="page" class="active sidebar-link">Protobuf第三方扩展开发指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/backend/protobuf/#第1章-了解protobuf" class="sidebar-link">第1章 了解Protobuf</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/backend/protobuf/#_1-1-protobuf是如何运行的" class="sidebar-link">1.1 Protobuf是如何运行的</a></li><li class="sidebar-sub-header"><a href="/backend/protobuf/#_1-2-编写第三方扩展的几种方案" class="sidebar-link">1.2 编写第三方扩展的几种方案</a></li></ul></li><li class="sidebar-sub-header"><a href="/backend/protobuf/#第2章-三种方案快速入门" class="sidebar-link">第2章 三种方案快速入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/backend/protobuf/#_2-1-方案一：通过c-接口实现编译器后端（不推荐）" class="sidebar-link">2.1 方案一：通过C++接口实现编译器后端（不推荐）</a></li><li class="sidebar-sub-header"><a href="/backend/protobuf/#_2-2-方案二：通过编写插件实现编译器后端（推荐）" class="sidebar-link">2.2 方案二：通过编写插件实现编译器后端（推荐）</a></li><li class="sidebar-sub-header"><a href="/backend/protobuf/#_2-3-方案三：自己编写编译器前端、后端" class="sidebar-link">2.3 方案三：自己编写编译器前端、后端</a></li><li class="sidebar-sub-header"><a href="/backend/protobuf/#_2-4-方案对比" class="sidebar-link">2.4 方案对比</a></li></ul></li><li class="sidebar-sub-header"><a href="/backend/protobuf/#第三章-protobuf插件开发详解" class="sidebar-link">第三章 Protobuf插件开发详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/backend/protobuf/#_3-1-代码如下" class="sidebar-link">3.1 代码如下</a></li></ul></li><li class="sidebar-sub-header"><a href="/backend/protobuf/#附录" class="sidebar-link">附录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/backend/protobuf/#附录：官方支持语言列表" class="sidebar-link">附录：官方支持语言列表</a></li><li class="sidebar-sub-header"><a href="/backend/protobuf/#附录：供参考的开源项目" class="sidebar-link">附录：供参考的开源项目</a></li></ul></li></ul></li><li><a href="/backend/docker.html" class="sidebar-link">Docker</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="protobuf第三方扩展开发指南"><a href="#protobuf第三方扩展开发指南" class="header-anchor">#</a> Protobuf第三方扩展开发指南</h1> <p>谷歌Protobuf目前最新3.6.1版本官方支持许多语言：C++、Java、Python、Go等等。除官方支持外<a href="https://github.com/protocolbuffers/protobuf/blob/master/docs/third_party.md" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>还列出了许多开源的第三方扩展。</p> <p>如果官方不支持自己的语言，各种开源库也不能满足需求，那么就需要自己动手编写第三方扩展来支持目标语言。</p> <p>本文介绍如何为Protobuf编写第三方扩展。注意：</p> <ul><li>本文不讨论谷歌RPC</li> <li>本文假设读者已经了解Protobuf的基本用法，如果你还不会用那么本文不适合你阅读</li></ul> <h2 id="第1章-了解protobuf"><a href="#第1章-了解protobuf" class="header-anchor">#</a> 第1章 了解Protobuf</h2> <p>Protobuf分为编译器和运行时两个部分。本章介绍Protobuf是如何工作的。</p> <h3 id="_1-1-protobuf是如何运行的"><a href="#_1-1-protobuf是如何运行的" class="header-anchor">#</a> 1.1 Protobuf是如何运行的</h3> <p>通常我们编写好<code>xxx.proto</code>文件后需要：</p> <ul><li>编译：将proto文件编译生成目标码，不同目标语言的目标码形式都不相同。
以Python为例，<code>protoc --python_out=/path/to/output/ xxx.proto</code>会生成<code>xxx_pb2.py</code>。
<code>protoc</code>可以在GitHub的<a href="https://github.com/protocolbuffers/protobuf/releases" target="_blank" rel="noopener noreferrer">release页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>下载，例如：protoc-3.6.1-linux-x86_64.zip。</li> <li>运行：将生成的目标码拷贝至目标机运行，要求目标机上有对应的运行时。
以Python为例，Python应用程序中可以直接调用：<code>import xxx_pb2</code>。
运行需要依赖Protobuf的Python运行时，可以在release页面下载，例如：protobuf-python-3.6.1.tar.gz。</li></ul> <p>图1-1 显示了Protobuf是如何工作的，也有的时候编译、运行是在同一个机器上进行的。</p> <p><img src="/assets/img/1-1.28ee42b8.png" alt="图1-1 Protobuf工作流程"></p> <h3 id="_1-2-编写第三方扩展的几种方案"><a href="#_1-2-编写第三方扩展的几种方案" class="header-anchor">#</a> 1.2 编写第三方扩展的几种方案</h3> <p>读到这应该也猜到了，我们需要编写编译器和运行时两个部分。运行时没什么好说的，可以参考后续的Demo。编译器分为前端和后端两个部分，见图1-2。</p> <p><img src="data:image/png;base64,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" alt="图1-2 编译器前端、后端、目标码"></p> <p>谷歌已经实现了编译器前端，在此基础上我们只需要编写编译器后端即可：</p> <ul><li>方案一：在谷歌CommandLineInterface接口的基础上进一步开发，该接口封装了Protobuf编译器前端，在此基础上你可以轻松实现编译器后端；你必须使用C++语言开发后端；</li> <li>方案二：编写插件来实现，Protobuf 3.0开始支持插件，这是目前最推荐的方式；</li> <li>方案三：自己编写编译器前端和后端，如果没有特殊需求的话非常不推荐这种方式，详见下文；</li></ul> <h2 id="第2章-三种方案快速入门"><a href="#第2章-三种方案快速入门" class="header-anchor">#</a> 第2章 三种方案快速入门</h2> <h3 id="_2-1-方案一：通过c-接口实现编译器后端（不推荐）"><a href="#_2-1-方案一：通过c-接口实现编译器后端（不推荐）" class="header-anchor">#</a> 2.1 方案一：通过C++接口实现编译器后端（不推荐）</h3> <p>早期Protobuf 2不支持插件，因此一些较老的开源项目是使用此方案，如：</p> <ul><li>protobuf-c</li></ul> <p>Protobuf 3开始已经支持插件了，我们推荐使用插件实现，本节的技术点算是过时了。</p> <h4 id="_2-1-1-项目需求介绍"><a href="#_2-1-1-项目需求介绍" class="header-anchor">#</a> 2.1.1 项目需求介绍</h4> <p>本节实现一个简易的Protobuf三方扩展，命名为protoc-gen-hi。输入是proto文件，输出是一些“hello”。
例如对于这个proto输入：</p> <div class="language- extra-class"><pre class="language-text"><code>syntax = &quot;proto3&quot;;
package demo;

message Person {
    string name = 1;
    int32 id = 2;
    string email = 3;
}
</code></pre></div><p>protoc-gen-hi对应的输出是：</p> <div class="language- extra-class"><pre class="language-text"><code>hello Person
hello name
hello id
hello email
</code></pre></div><h4 id="_2-1-2-开发环境搭建"><a href="#_2-1-2-开发环境搭建" class="header-anchor">#</a> 2.1.2 开发环境搭建</h4> <p>在Release页面下载Protobuf源码：<a href="https://github.com/protocolbuffers/protobuf/releases/" target="_blank" rel="noopener noreferrer">protobuf-all-3.6.1.tar.gz<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
解压：<code>tar xf ./protobuf-all-3.6.1.tar.gz</code></p> <p>编译：</p> <ul><li><code>cd ./protobuf-all-3.6.1</code></li> <li><code>sh ./autogen.sh</code>，可能会因为没有装<code>libtool</code>报错</li> <li><code>./configure</code>，可能会因为没有安装<code>g++</code>报错</li> <li><code>make</code>，需要等挺久的</li></ul> <p>编译主要是希望得到这些文件：</p> <ul><li>./src/.libs/libprotoc.so</li> <li>./src/.libs/libprotobuf.so</li> <li>./src/.libs/libprotoc.a</li> <li>./src/.libs/libprotobuf.a</li></ul> <p>创建工作目录：<code>mkdir lab1</code>，创建完成后本地目录应该是这样的：</p> <div class="language- extra-class"><pre class="language-text"><code>.
|-- lab1
|-- protobuf-3.6.1
|   |-- src
|   |   |-- .libs
|   |   |   |-- libprotobuf.a
|   |   |   |-- libprotobuf.so
|   |   |   |-- libprotoc.a
|   |   |   |-- libprotoc.so
|   |   |   `-- protoc
|   |   `-- google
|   `-- Makefile
`-- protobuf-all-3.6.1.tar.gz
</code></pre></div><h4 id="_2-1-3-开始写代码"><a href="#_2-1-3-开始写代码" class="header-anchor">#</a> 2.1.3 开始写代码</h4> <p>现在我们开始编写第一个编译器。在<strong>lab1</strong>目录下创建几个文件，完成后工作区应该是这样的：</p> <div class="language- extra-class"><pre class="language-text"><code>.
|-- lab1
|   |-- test
|   |   `-- person.proto
|   |-- Makefile
|   |-- main.cc
|   |-- hi_generator.cc
|   `-- hi_generator.h
|-- protobuf-3.6.1
`-- protobuf-all-3.6.1.tar.gz
</code></pre></div><p>其中main.cc关键代码如下：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 将我们的编译器关联到cli</span>
<span class="token comment">// 参考谷歌官方文档：</span>
<span class="token comment">// https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.command_line_interface</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    google<span class="token operator">::</span>protobuf<span class="token operator">::</span>compiler<span class="token operator">::</span>CommandLineInterface cli<span class="token punctuation">;</span>

    <span class="token comment">// 官方实现的C++编译器后端</span>
    google<span class="token operator">::</span>protobuf<span class="token operator">::</span>compiler<span class="token operator">::</span>cpp<span class="token operator">::</span>CppGenerator cpp_generator<span class="token punctuation">;</span>
    cli<span class="token punctuation">.</span><span class="token function">RegisterGenerator</span><span class="token punctuation">(</span><span class="token string">&quot;--cpp_out&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cpp_generator<span class="token punctuation">,</span> <span class="token string">&quot;Generate C++ source and header.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 我们需要实现的编译器后端</span>
    google<span class="token operator">::</span>protobuf<span class="token operator">::</span>compiler<span class="token operator">::</span>c<span class="token operator">::</span>HiGenerator hi_generator<span class="token punctuation">;</span>
    cli<span class="token punctuation">.</span><span class="token function">RegisterGenerator</span><span class="token punctuation">(</span><span class="token string">&quot;--hi_out&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hi_generator<span class="token punctuation">,</span> <span class="token string">&quot;Generate C header.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> cli<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>hi_generator.cc关键代码如下，读者只需要关注<code>FileDescriptor</code>参数和<code>io::Printer</code>变量：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// FileDescriptor就是语法树，参考：</span>
<span class="token comment">// https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.descriptor</span>
<span class="token keyword">bool</span> <span class="token class-name">HiGenerator</span><span class="token operator">::</span><span class="token function">Generate</span><span class="token punctuation">(</span><span class="token keyword">const</span> FileDescriptor<span class="token operator">*</span> file<span class="token punctuation">,</span>
                            <span class="token keyword">const</span> string<span class="token operator">&amp;</span> parameter<span class="token punctuation">,</span>
                            GeneratorContext<span class="token operator">*</span> context<span class="token punctuation">,</span>
                            string<span class="token operator">*</span> error<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    string filename <span class="token operator">=</span> file<span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    string output_filename <span class="token operator">=</span> <span class="token function">ReplaceSuffix</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">&quot;.proto&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 文件名proto后缀替换为txt，这样xxx.proto的生成物就是xxx.txt</span>

    std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>io<span class="token operator">::</span>ZeroCopyOutputStream<span class="token operator">&gt;</span> <span class="token function">output</span><span class="token punctuation">(</span>context<span class="token operator">-&gt;</span><span class="token function">Open</span><span class="token punctuation">(</span>output_filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GOOGLE_CHECK</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    io<span class="token operator">::</span>Printer <span class="token function">printer</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 指定$符号作为模板变量的定界符（delimitation）</span>

    printer<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Hello $file$!\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// file是一个模板变量，file变量的值是`filename'</span>
    <span class="token comment">// 假设filename变量现在是&quot;person.proto&quot;，那么这里会被替换为&quot;Hello person.proto!\n&quot;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> file<span class="token operator">-&gt;</span><span class="token function">message_type_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> Descriptor <span class="token operator">*</span>message <span class="token operator">=</span> file<span class="token operator">-&gt;</span><span class="token function">message_type</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        printer<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Hello $message$!\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> message<span class="token operator">-&gt;</span><span class="token function">full_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第一个编译器写好了，完整代码见：https://github.com/chend0316/protoc-lab/tree/master/lab1</p> <h4 id="_2-1-4-编译、运行"><a href="#_2-1-4-编译、运行" class="header-anchor">#</a> 2.1.4 编译、运行</h4> <p>通过<code>make</code>编译完成后，我们运行一下：<code>./myprotoc --c_out=./test ./test/person.proto</code>
运行后可以看到生成了这个文件**./test/test/person.txt**，打开来看看效果。</p> <h4 id="_2-1-5-proto语法树对应的c-接口"><a href="#_2-1-5-proto语法树对应的c-接口" class="header-anchor">#</a> 2.1.5 proto语法树对应的C++接口</h4> <p><img src="/assets/img/2-0.092e22d5.png" alt="proto语法树（C++）"></p> <h4 id="_2-1-6-参考资料"><a href="#_2-1-6-参考资料" class="header-anchor">#</a> 2.1.6 参考资料</h4> <h3 id="_2-2-方案二：通过编写插件实现编译器后端（推荐）"><a href="#_2-2-方案二：通过编写插件实现编译器后端（推荐）" class="header-anchor">#</a> 2.2 方案二：通过编写插件实现编译器后端（推荐）</h3> <p>编译器后端无非就是获取proto语法树，然后进行生成。在方案一中，语法树是通过C++的一个类来表达的，这样就导致后端代码需要依赖谷歌C++的头文件和库，兼容性较差。</p> <p>而方案二是通过proto数据流来表达语法树的，后端只要依赖相应语言的Protobuf库即可。这是兼容性最好的方案。由于Protobuf官方就支持：C++、Dart、Go、Java、Python、Ruby、C#、OC、Javascript、PHP，因此无论使用上述哪种语言都可以用来开发编译器后端插件。</p> <h4 id="_2-2-1-一个哲学概念"><a href="#_2-2-1-一个哲学概念" class="header-anchor">#</a> 2.2.1 一个哲学概念</h4> <p>proto代码定义的是信息的模型，例如下面一段proto代码定义的就是人的信息模型：</p> <div class="language- extra-class"><pre class="language-text"><code>syntax = &quot;proto3&quot;;
package demo;

message Person {
    string name = 1;
    int32 id = 2;
    string email = 3;
}
</code></pre></div><p>而这段信息模型对应的一个可能的信息内容是：</p> <div class="language- extra-class"><pre class="language-text"><code>张三, 112233, zhangsan@163.com
</code></pre></div><p>这样我们就知道信息模型是信息内容的抽象泛化，它们处于不同层次。就好像我们可以通过橡皮泥模子捏出各种颜色的橡皮泥。那么信息模型就好比橡皮泥模子，而信息内容就好比捏出来的橡皮泥。</p> <p><img src="/assets/img/2-1.54dd4401.png" alt="image.png"></p> <p>然而proto代码自身也可以看做是信息，它也能有对应的模型，即：proto代码是proto代码的模型，这听起来真的很绕，自己怎么就成了自己的模型了呢。其实更详细的说应该是：有一种特殊的proto代码，它是其它任意proto代码的模型，这个特殊的proto代码就是<a href="https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/descriptor.proto" target="_blank" rel="noopener noreferrer">descriptor.proto<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。这真的很哲学，从某角度来看descriptor.proto也是proto代码，它和普通proto代码是同一个层次的；但从另一个角度来看descriptor.proto能作为所有proto代码的模型，它又和普通proto代码不在同一个层次。</p> <p>descriptor.proto的这种现象在计算机科学中叫做「元（meta）」，例如：</p> <ul><li>在Python中我们用一个类来定义其它类，这叫元类</li> <li>在Lua中我们用一个表来定义其它表，这叫元表</li> <li>类似的词汇你可能还听过很多，例如：元编程</li></ul> <p>几乎毫无例外的，各个技术领域出现的「元」的概念都成为最难理解的知识点之一，元本身的概念超出了本文范围。</p> <h4 id="_2-2-2-插件的运行流程"><a href="#_2-2-2-插件的运行流程" class="header-anchor">#</a> 2.2.2 插件的运行流程</h4> <p>在执行protoc编译的时候，命令行是这样写的：<code>protoc -python_out=./ *.proto</code>，Protobuf原生支持Python所以认识<code>-python_out</code>，这表示把当前目录下所有proto都编译成python。如果我们命令行这样写：<code>protoc -xxx_out=./ *.proto</code>，由于不认识xxx，于是<code>protoc</code>会在PATH路径下寻找一个叫做<code>protoc-gen-xxx</code>的可执行文件。而<code>protoc-gen-xxx</code>就是我们要实现的插件。</p> <p>插件的运行流程如图：</p> <ul><li>我们只需要关注步骤3.1~3.5，其余步骤是谷歌protoc完成</li> <li>CodeGeneratorRequest和CodeGeneratorResponse对象定义在<a href="https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/compiler/plugin.proto" target="_blank" rel="noopener noreferrer">plugin.proto<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>里面</li> <li>FileDescriptor代表了一个proto文件，定义在<a href="https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/descriptor.proto" target="_blank" rel="noopener noreferrer">descriptor.proto<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>里面</li></ul> <p><img src="/assets/img/2-2.761e057d.png" alt="image.png"></p> <h4 id="_2-2-3-插件具体实现代码"><a href="#_2-2-3-插件具体实现代码" class="header-anchor">#</a> 2.2.3 插件具体实现代码</h4> <p>本章概述就说了插件可以通过多种语言（Python、Java、C#等）实现，这里我们以Python为例。实现涉及到的主要类为：</p> <ul><li>CodeGeneratorRequest对应：<code>from google.protobuf.compiler.plugin_pb2 import CodeGeneratorRequest</code></li> <li>CodeGeneratorResponse对应：<code>from google.protobuf.compiler.plugin_pb2 import CodeGeneratorResponse</code></li> <li>FileDescriptor对应：<code>from google.protobuf.descriptor import FileDescriptor</code></li></ul> <p>一个简单的Demo代码如下，将代码命名为<code>protoc-gen-hello</code>，赋予可执行权限，然后放置到<code>PATH</code>路径下：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python3</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>compiler <span class="token keyword">import</span> plugin_pb2

<span class="token comment"># 3.1 读取二进制</span>
input_data <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 3.2 反序列化</span>
req <span class="token operator">=</span> plugin_pb2<span class="token punctuation">.</span>CodeGeneratorRequest<span class="token punctuation">.</span>FromString<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span>

<span class="token comment"># 3.3 根据业务需求具体实现</span>
<span class="token comment"># req.proto_file[0]是FileDescriptor类型的对象</span>
<span class="token comment"># 正常业务肯定要通过req.proto_file[0]读取proto代码的信息，然后根据具体业务需求解析</span>
<span class="token comment"># 但这段代码只是为了简单演示，就不读取了</span>

<span class="token comment"># 3.4 构造CodeGeneratorResponse对象</span>
<span class="token comment"># 下面这段逻辑说明，不管输入的proto如何</span>
<span class="token comment"># 本插件都会输出aaa.txt和bbb.txt文件，文件内容都是hello</span>
resp <span class="token operator">=</span> plugin_pb2<span class="token punctuation">.</span>CodeGeneratorResponse<span class="token punctuation">(</span><span class="token punctuation">)</span>
resp<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">)</span>
resp<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'aaa.txt'</span>
resp<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">'hello'</span>
resp<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">)</span>
resp<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'bbb.txt'</span>
resp<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">'hello'</span>

<span class="token comment"># 3.5 将CodeGeneratorResponse序列化成二进制后打印</span>
sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>SerializeToString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>为了运行这段代码，我们的命令是：<code>protoc --hello_out=./ *.proto</code>，这样protoc会去寻找一个叫做<code>protoc-gen-hello</code>的可执行文件。</p> <h3 id="_2-3-方案三：自己编写编译器前端、后端"><a href="#_2-3-方案三：自己编写编译器前端、后端" class="header-anchor">#</a> 2.3 方案三：自己编写编译器前端、后端</h3> <p>此法风险和难度比较大：</p> <ul><li>需要开发者熟练掌握编译原理</li> <li>谷歌并没有对此方案提供任何技术支持</li> <li>Protobuf有一些隐含语法，这部分并没有在官方文档中说明，让此方案的兼容性得不到保障</li></ul> <p>如果有特殊需求才考虑此法：</p> <ul><li>有proto文件热加载需求，即希望应用能够直接加载proto文件</li></ul> <p>目前也有一些开源库使用此方案：</p> <ul><li>https://github.com/dcodeIO/protobuf.js</li></ul> <h3 id="_2-4-方案对比"><a href="#_2-4-方案对比" class="header-anchor">#</a> 2.4 方案对比</h3> <p>方案一只能通过C++实现。如果不是遗留项目，方案一没有什么优势。</p> <p>方案二可选开发语言多样，推荐使用。</p> <p>方案三难度最大，基本只有特殊需求、学习研究会考虑此法。</p> <h2 id="第三章-protobuf插件开发详解"><a href="#第三章-protobuf插件开发详解" class="header-anchor">#</a> 第三章 Protobuf插件开发详解</h2> <p>在2.2节中已经介绍了基本内容，因为从Protobuf 3开始这是最常用的方法，所以这里花一个章节的篇幅详细介绍。</p> <p>本章以Python语言为例编写一个简易的Protobuf插件，该插件的名字是<code>protoc-gen-lint</code>，用来检测proto代码是否有潜在问题。我们知道一个成熟的lint工具检测内容是非常多的，甚至包括英语单词拼写是否正确，但是本章作为教学例子，只做了非常有限的几个功能。</p> <p>本章例子的检测的内容是：</p> <ul><li>判断message名是否为驼峰命名法，即不能含有下划线、不能有两个连续大写字母出现</li> <li>等等</li></ul> <h3 id="_3-1-代码如下"><a href="#_3-1-代码如下" class="header-anchor">#</a> 3.1 代码如下</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python3</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>compiler <span class="token keyword">import</span> plugin_pb2

input_data <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
req <span class="token operator">=</span> plugin_pb2<span class="token punctuation">.</span>CodeGeneratorRequest<span class="token punctuation">.</span>FromString<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span>
resp <span class="token operator">=</span> plugin_pb2<span class="token punctuation">.</span>CodeGeneratorResponse<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> f <span class="token keyword">in</span> req<span class="token punctuation">.</span>proto_file<span class="token punctuation">:</span>
    log <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> m <span class="token keyword">in</span> f<span class="token punctuation">.</span>message_type<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'_'</span> <span class="token keyword">in</span> m<span class="token punctuation">.</span>name<span class="token punctuation">:</span>
            <span class="token comment"># 判断是否存在下划线</span>
            log <span class="token operator">+=</span> <span class="token string">'{0}中的{1}不符合驼峰命名法\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>name<span class="token punctuation">,</span> m<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 判断是否存在连续的大写字母</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> m<span class="token punctuation">.</span>name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">and</span> m<span class="token punctuation">.</span>name<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    log <span class="token operator">+=</span> <span class="token string">'{0}中的{1}不符合驼峰命名法\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>name<span class="token punctuation">,</span> m<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
    <span class="token keyword">if</span> log <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">:</span>
        <span class="token comment"># 若确实存在问题，则将报错信息输出到.lint.txt后缀的文件中</span>
        resp<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">)</span>
        resp<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> f<span class="token punctuation">.</span>name<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">'.proto'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.lint.txt'</span>
        resp<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">=</span> log

sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>SerializeToString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h2> <h3 id="附录：官方支持语言列表"><a href="#附录：官方支持语言列表" class="header-anchor">#</a> 附录：官方支持语言列表</h3> <h3 id="附录：供参考的开源项目"><a href="#附录：供参考的开源项目" class="header-anchor">#</a> 附录：供参考的开源项目</h3></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/chend0316/blog/edit/master/docs/backend/protobuf/readme.md" target="_blank" rel="noopener noreferrer">编辑此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最后编辑:</span> <span class="time">12/6/2020, 2:38:10 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.491867c0.js" defer></script><script src="/assets/js/2.be1f9426.js" defer></script><script src="/assets/js/3.bddbc11c.js" defer></script>
  </body>
</html>
