(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{363:function(s,t,a){s.exports=a.p+"assets/img/vue2-options-api-concerns.f268f159.png"},392:function(s,t,a){"use strict";a.r(t);var n=a(42),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"vue-3-迁移指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue-3-迁移指南"}},[s._v("#")]),s._v(" Vue 3 迁移指南")]),s._v(" "),n("p",[s._v("这里的内容全部来自官方文档，现在是 2020-09-13，官方还没有中文文档，对 Vue 3 我还是小白。这里的内容供大家参考和交流。")]),s._v(" "),n("h2",{attrs:{id:"composition-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#composition-api"}},[s._v("#")]),s._v(" Composition API")]),s._v(" "),n("h3",{attrs:{id:"为啥需要-composition-api-呢？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为啥需要-composition-api-呢？"}},[s._v("#")]),s._v(" 为啥需要 Composition API 呢？")]),s._v(" "),n("p",[s._v("Vue 组件 (Components) 已经能大大提升代码可维护性、灵活性了，但对于大型项目这还不够，我们需要有更加强大的代码复用能力。")]),s._v(" "),n("p",[s._v("下图是 Vue 2 使用 options API 的代码，我们来看下有啥问题。我们将业务逻辑相关的代码用相同的颜色标注出来了，用术语说就是不同颜色代表不同的关注点 (Concerns)。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(363),alt:""}})]),s._v(" "),n("p",[s._v("你会看到不同颜色的代码混在一起了，这就非常不符合关注点分离 (Separation of concerns) 原则。阅读代码的时候不得不在不同颜色的代码块之间进行“跳跃”，这让代码变得更加费解。")]),s._v(" "),n("p",[s._v("现在 Composition API 可以帮助我们把相同关注点的代码聚集在一起，把不同关注点的代码分开来。")]),s._v(" "),n("h3",{attrs:{id:"如何使用-composition-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何使用-composition-api"}},[s._v("#")]),s._v(" 如何使用 Composition API")]),s._v(" "),n("p",[s._v("就是 API 增加了一个 "),n("code",[s._v("setup()")]),s._v("。")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("setup()")]),s._v(" 的入参有两个: "),n("code",[s._v("props")]),s._v(" 和 "),n("code",[s._v("context")])]),s._v(" "),n("li",[n("code",[s._v("setup()")]),s._v(" 可以返回: 计算属性、methods、生命周期钩子等等")]),s._v(" "),n("li",[s._v("在生命周期上 "),n("code",[s._v("setup()")]),s._v(" 比组件实例化要晚，所以函数体内无法访问 "),n("code",[s._v("this")]),s._v(" 指针")])]),s._v(" "),n("p",[s._v("总的来说，以前 options 里面编写的内容都是静态的；而现在可以由 "),n("code",[s._v("setup()")]),s._v(" 动态生成了。")]),s._v(" "),n("p",[s._v("下面这个例子是在 "),n("code",[s._v("setup()")]),s._v(" 里面定义 data 和 method。")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// src/components/UserRepositories.vue")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" fetchUserRepositories "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@/api/repositories'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ref "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  components"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" RepositoriesFilters"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" RepositoriesSortBy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" RepositoriesList "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  props"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" String "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("props")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" repositories "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ref")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ref() 可以把数据变为响应式的")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("getUserRepositories")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      repositories "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fetchUserRepositories")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("props"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      repositories"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// data")]),s._v("\n      getUserRepositories "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// method")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("看起来我们只是把原先定义在 options 上的东西移动到了 setup 里面，但后续我们会把 setup 里面的代码提取出来，并且不同的功能放到不同的函数/文件里面，这就实现了关注点分离。")]),s._v(" "),n("h2",{attrs:{id:"ref"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ref"}},[s._v("#")]),s._v(" Ref()")]),s._v(" "),n("p",[s._v("JS 中对于原始类型 (primitive types) 是采用值传递的，"),n("code",[s._v("ref()")]),s._v(" 可以将原始类型包装到一个对象里面去，变成引用传递，这就类似于其它语言中的装箱 (boxing)。不过除了包装原始类型 "),n("code",[s._v("ref()")]),s._v(" 也可以包装一个对象，所以并不完全等同于装箱，在 Vue 中把这个过程叫做 wrap。wrap 后数据会放到 "),n("code",[s._v("value")]),s._v(" 字段里面，代码如下。")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ref "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" counter "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ref")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("counter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// { value: 0 }")]),s._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("counter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 0")]),s._v("\n\ncounter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("counter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("wrap 带来的影响如下。")]),s._v(" "),n("ol",[n("li",[s._v("所有数据都被包在 "),n("code",[s._v("value")]),s._v(" 字段里，有点怪怪的，开发者要适应一下；")]),s._v(" "),n("li",[s._v("消除了原始类型、值传递，可以帮助 Vue 更彻底的控制 data；因为 Vue 3 把 data 抽出来了，很容易失去对 data 的掌控，从而丢失数据响应式；")])]),s._v(" "),n("p",[s._v("关于第2点，这里打个比方。Vue 2 所有 data 都是挂在 vm 实例里面的，但 Vue 3 把 data 放出来了，所以需要包装到 "),n("code",[s._v("value")]),s._v(" 字段里面避免弄丢。类似于出门遛狗要牵绳。")]),s._v(" "),n("p",[s._v("todo: 给一个丢失数据响应式的例子吧？这篇是入门篇，有必要给这个例子吗？")])])}),[],!1,null,null,null);t.default=e.exports}}]);