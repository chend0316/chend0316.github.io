(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{352:function(t,s,a){t.exports=a.p+"assets/img/1-1.28ee42b8.png"},353:function(t,s){t.exports="data:image/png;base64,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"},354:function(t,s,a){t.exports=a.p+"assets/img/2-0.092e22d5.png"},355:function(t,s,a){t.exports=a.p+"assets/img/2-1.54dd4401.png"},356:function(t,s,a){t.exports=a.p+"assets/img/2-2.761e057d.png"},369:function(t,s,a){"use strict";a.r(s);var n=a(43),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"protobuf第三方扩展开发指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#protobuf第三方扩展开发指南"}},[t._v("#")]),t._v(" Protobuf第三方扩展开发指南")]),t._v(" "),n("p",[t._v("谷歌Protobuf目前最新3.6.1版本官方支持许多语言：C++、Java、Python、Go等等。除官方支持外"),n("a",{attrs:{href:"https://github.com/protocolbuffers/protobuf/blob/master/docs/third_party.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),n("OutboundLink")],1),t._v("还列出了许多开源的第三方扩展。")]),t._v(" "),n("p",[t._v("如果官方不支持自己的语言，各种开源库也不能满足需求，那么就需要自己动手编写第三方扩展来支持目标语言。")]),t._v(" "),n("p",[t._v("本文介绍如何为Protobuf编写第三方扩展。注意：")]),t._v(" "),n("ul",[n("li",[t._v("本文不讨论谷歌RPC")]),t._v(" "),n("li",[t._v("本文假设读者已经了解Protobuf的基本用法，如果你还不会用那么本文不适合你阅读")])]),t._v(" "),n("h2",{attrs:{id:"第1章-了解protobuf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第1章-了解protobuf"}},[t._v("#")]),t._v(" 第1章 了解Protobuf")]),t._v(" "),n("p",[t._v("Protobuf分为编译器和运行时两个部分。本章介绍Protobuf是如何工作的。")]),t._v(" "),n("h3",{attrs:{id:"_1-1-protobuf是如何运行的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-protobuf是如何运行的"}},[t._v("#")]),t._v(" 1.1 Protobuf是如何运行的")]),t._v(" "),n("p",[t._v("通常我们编写好"),n("code",[t._v("xxx.proto")]),t._v("文件后需要：")]),t._v(" "),n("ul",[n("li",[t._v("编译：将proto文件编译生成目标码，不同目标语言的目标码形式都不相同。\n以Python为例，"),n("code",[t._v("protoc --python_out=/path/to/output/ xxx.proto")]),t._v("会生成"),n("code",[t._v("xxx_pb2.py")]),t._v("。\n"),n("code",[t._v("protoc")]),t._v("可以在GitHub的"),n("a",{attrs:{href:"https://github.com/protocolbuffers/protobuf/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("release页面"),n("OutboundLink")],1),t._v("下载，例如：protoc-3.6.1-linux-x86_64.zip。")]),t._v(" "),n("li",[t._v("运行：将生成的目标码拷贝至目标机运行，要求目标机上有对应的运行时。\n以Python为例，Python应用程序中可以直接调用："),n("code",[t._v("import xxx_pb2")]),t._v("。\n运行需要依赖Protobuf的Python运行时，可以在release页面下载，例如：protobuf-python-3.6.1.tar.gz。")])]),t._v(" "),n("p",[t._v("图1-1 显示了Protobuf是如何工作的，也有的时候编译、运行是在同一个机器上进行的。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(352),alt:"图1-1 Protobuf工作流程"}})]),t._v(" "),n("h3",{attrs:{id:"_1-2-编写第三方扩展的几种方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-编写第三方扩展的几种方案"}},[t._v("#")]),t._v(" 1.2 编写第三方扩展的几种方案")]),t._v(" "),n("p",[t._v("读到这应该也猜到了，我们需要编写编译器和运行时两个部分。运行时没什么好说的，可以参考后续的Demo。编译器分为前端和后端两个部分，见图1-2。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(353),alt:"图1-2 编译器前端、后端、目标码"}})]),t._v(" "),n("p",[t._v("谷歌已经实现了编译器前端，在此基础上我们只需要编写编译器后端即可：")]),t._v(" "),n("ul",[n("li",[t._v("方案一：在谷歌CommandLineInterface接口的基础上进一步开发，该接口封装了Protobuf编译器前端，在此基础上你可以轻松实现编译器后端；你必须使用C++语言开发后端；")]),t._v(" "),n("li",[t._v("方案二：编写插件来实现，Protobuf 3.0开始支持插件，这是目前最推荐的方式；")]),t._v(" "),n("li",[t._v("方案三：自己编写编译器前端和后端，如果没有特殊需求的话非常不推荐这种方式，详见下文；")])]),t._v(" "),n("h2",{attrs:{id:"第2章-三种方案快速入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第2章-三种方案快速入门"}},[t._v("#")]),t._v(" 第2章 三种方案快速入门")]),t._v(" "),n("h3",{attrs:{id:"_2-1-方案一：通过c-接口实现编译器后端（不推荐）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-方案一：通过c-接口实现编译器后端（不推荐）"}},[t._v("#")]),t._v(" 2.1 方案一：通过C++接口实现编译器后端（不推荐）")]),t._v(" "),n("p",[t._v("早期Protobuf 2不支持插件，因此一些较老的开源项目是使用此方案，如：")]),t._v(" "),n("ul",[n("li",[t._v("protobuf-c")])]),t._v(" "),n("p",[t._v("Protobuf 3开始已经支持插件了，我们推荐使用插件实现，本节的技术点算是过时了。")]),t._v(" "),n("h4",{attrs:{id:"_2-1-1-项目需求介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-项目需求介绍"}},[t._v("#")]),t._v(" 2.1.1 项目需求介绍")]),t._v(" "),n("p",[t._v("本节实现一个简易的Protobuf三方扩展，命名为protoc-gen-hi。输入是proto文件，输出是一些“hello”。\n例如对于这个proto输入：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('syntax = "proto3";\npackage demo;\n\nmessage Person {\n    string name = 1;\n    int32 id = 2;\n    string email = 3;\n}\n')])])]),n("p",[t._v("protoc-gen-hi对应的输出是：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("hello Person\nhello name\nhello id\nhello email\n")])])]),n("h4",{attrs:{id:"_2-1-2-开发环境搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-开发环境搭建"}},[t._v("#")]),t._v(" 2.1.2 开发环境搭建")]),t._v(" "),n("p",[t._v("在Release页面下载Protobuf源码："),n("a",{attrs:{href:"https://github.com/protocolbuffers/protobuf/releases/",target:"_blank",rel:"noopener noreferrer"}},[t._v("protobuf-all-3.6.1.tar.gz"),n("OutboundLink")],1),t._v("\n解压："),n("code",[t._v("tar xf ./protobuf-all-3.6.1.tar.gz")])]),t._v(" "),n("p",[t._v("编译：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("cd ./protobuf-all-3.6.1")])]),t._v(" "),n("li",[n("code",[t._v("sh ./autogen.sh")]),t._v("，可能会因为没有装"),n("code",[t._v("libtool")]),t._v("报错")]),t._v(" "),n("li",[n("code",[t._v("./configure")]),t._v("，可能会因为没有安装"),n("code",[t._v("g++")]),t._v("报错")]),t._v(" "),n("li",[n("code",[t._v("make")]),t._v("，需要等挺久的")])]),t._v(" "),n("p",[t._v("编译主要是希望得到这些文件：")]),t._v(" "),n("ul",[n("li",[t._v("./src/.libs/libprotoc.so")]),t._v(" "),n("li",[t._v("./src/.libs/libprotobuf.so")]),t._v(" "),n("li",[t._v("./src/.libs/libprotoc.a")]),t._v(" "),n("li",[t._v("./src/.libs/libprotobuf.a")])]),t._v(" "),n("p",[t._v("创建工作目录："),n("code",[t._v("mkdir lab1")]),t._v("，创建完成后本地目录应该是这样的：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v(".\n|-- lab1\n|-- protobuf-3.6.1\n|   |-- src\n|   |   |-- .libs\n|   |   |   |-- libprotobuf.a\n|   |   |   |-- libprotobuf.so\n|   |   |   |-- libprotoc.a\n|   |   |   |-- libprotoc.so\n|   |   |   `-- protoc\n|   |   `-- google\n|   `-- Makefile\n`-- protobuf-all-3.6.1.tar.gz\n")])])]),n("h4",{attrs:{id:"_2-1-3-开始写代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-开始写代码"}},[t._v("#")]),t._v(" 2.1.3 开始写代码")]),t._v(" "),n("p",[t._v("现在我们开始编写第一个编译器。在"),n("strong",[t._v("lab1")]),t._v("目录下创建几个文件，完成后工作区应该是这样的：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v(".\n|-- lab1\n|   |-- test\n|   |   `-- person.proto\n|   |-- Makefile\n|   |-- main.cc\n|   |-- hi_generator.cc\n|   `-- hi_generator.h\n|-- protobuf-3.6.1\n`-- protobuf-all-3.6.1.tar.gz\n")])])]),n("p",[t._v("其中main.cc关键代码如下：")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将我们的编译器关联到cli")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 参考谷歌官方文档：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.command_line_interface")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    google"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("protobuf"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("compiler"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("CommandLineInterface cli"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 官方实现的C++编译器后端")]),t._v("\n    google"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("protobuf"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("compiler"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("CppGenerator cpp_generator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    cli"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RegisterGenerator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--cpp_out"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("cpp_generator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Generate C++ source and header."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我们需要实现的编译器后端")]),t._v("\n    google"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("protobuf"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("compiler"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("HiGenerator hi_generator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    cli"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RegisterGenerator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--hi_out"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("hi_generator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Generate C header."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cli"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("hi_generator.cc关键代码如下，读者只需要关注"),n("code",[t._v("FileDescriptor")]),t._v("参数和"),n("code",[t._v("io::Printer")]),t._v("变量：")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// FileDescriptor就是语法树，参考：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.descriptor")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bool")]),t._v(" HiGenerator"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Generate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" FileDescriptor"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" string"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" parameter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            GeneratorContext"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            string"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    string filename "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" file"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    string output_filename "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ReplaceSuffix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('".proto"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('".txt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件名proto后缀替换为txt，这样xxx.proto的生成物就是xxx.txt")]),t._v("\n\n    std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("unique_ptr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("io"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("ZeroCopyOutputStream"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("output")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("output_filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GOOGLE_CHECK")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("output"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    io"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Printer "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("output"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定$符号作为模板变量的定界符（delimitation）")]),t._v("\n\n    printer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello $file$!\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// file是一个模板变量，file变量的值是`filename'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 假设filename变量现在是"person.proto"，那么这里会被替换为"Hello person.proto!\\n"')]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" file"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("message_type_count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Descriptor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("message "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" file"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("message_type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        printer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello $message$!\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("full_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("第一个编译器写好了，完整代码见：https://github.com/chend0316/protoc-lab/tree/master/lab1")]),t._v(" "),n("h4",{attrs:{id:"_2-1-4-编译、运行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-编译、运行"}},[t._v("#")]),t._v(" 2.1.4 编译、运行")]),t._v(" "),n("p",[t._v("通过"),n("code",[t._v("make")]),t._v("编译完成后，我们运行一下："),n("code",[t._v("./myprotoc --c_out=./test ./test/person.proto")]),t._v("\n运行后可以看到生成了这个文件**./test/test/person.txt**，打开来看看效果。")]),t._v(" "),n("h4",{attrs:{id:"_2-1-5-proto语法树对应的c-接口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-proto语法树对应的c-接口"}},[t._v("#")]),t._v(" 2.1.5 proto语法树对应的C++接口")]),t._v(" "),n("p",[n("img",{attrs:{src:a(354),alt:"proto语法树（C++）"}})]),t._v(" "),n("h4",{attrs:{id:"_2-1-6-参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-6-参考资料"}},[t._v("#")]),t._v(" 2.1.6 参考资料")]),t._v(" "),n("h3",{attrs:{id:"_2-2-方案二：通过编写插件实现编译器后端（推荐）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-方案二：通过编写插件实现编译器后端（推荐）"}},[t._v("#")]),t._v(" 2.2 方案二：通过编写插件实现编译器后端（推荐）")]),t._v(" "),n("p",[t._v("编译器后端无非就是获取proto语法树，然后进行生成。在方案一中，语法树是通过C++的一个类来表达的，这样就导致后端代码需要依赖谷歌C++的头文件和库，兼容性较差。")]),t._v(" "),n("p",[t._v("而方案二是通过proto数据流来表达语法树的，后端只要依赖相应语言的Protobuf库即可。这是兼容性最好的方案。由于Protobuf官方就支持：C++、Dart、Go、Java、Python、Ruby、C#、OC、Javascript、PHP，因此无论使用上述哪种语言都可以用来开发编译器后端插件。")]),t._v(" "),n("h4",{attrs:{id:"_2-2-1-一个哲学概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-一个哲学概念"}},[t._v("#")]),t._v(" 2.2.1 一个哲学概念")]),t._v(" "),n("p",[t._v("proto代码定义的是信息的模型，例如下面一段proto代码定义的就是人的信息模型：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('syntax = "proto3";\npackage demo;\n\nmessage Person {\n    string name = 1;\n    int32 id = 2;\n    string email = 3;\n}\n')])])]),n("p",[t._v("而这段信息模型对应的一个可能的信息内容是：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("张三, 112233, zhangsan@163.com\n")])])]),n("p",[t._v("这样我们就知道信息模型是信息内容的抽象泛化，它们处于不同层次。就好像我们可以通过橡皮泥模子捏出各种颜色的橡皮泥。那么信息模型就好比橡皮泥模子，而信息内容就好比捏出来的橡皮泥。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(355),alt:"image.png"}})]),t._v(" "),n("p",[t._v("然而proto代码自身也可以看做是信息，它也能有对应的模型，即：proto代码是proto代码的模型，这听起来真的很绕，自己怎么就成了自己的模型了呢。其实更详细的说应该是：有一种特殊的proto代码，它是其它任意proto代码的模型，这个特殊的proto代码就是"),n("a",{attrs:{href:"https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/descriptor.proto",target:"_blank",rel:"noopener noreferrer"}},[t._v("descriptor.proto"),n("OutboundLink")],1),t._v("。这真的很哲学，从某角度来看descriptor.proto也是proto代码，它和普通proto代码是同一个层次的；但从另一个角度来看descriptor.proto能作为所有proto代码的模型，它又和普通proto代码不在同一个层次。")]),t._v(" "),n("p",[t._v("descriptor.proto的这种现象在计算机科学中叫做「元（meta）」，例如：")]),t._v(" "),n("ul",[n("li",[t._v("在Python中我们用一个类来定义其它类，这叫元类")]),t._v(" "),n("li",[t._v("在Lua中我们用一个表来定义其它表，这叫元表")]),t._v(" "),n("li",[t._v("类似的词汇你可能还听过很多，例如：元编程")])]),t._v(" "),n("p",[t._v("几乎毫无例外的，各个技术领域出现的「元」的概念都成为最难理解的知识点之一，元本身的概念超出了本文范围。")]),t._v(" "),n("h4",{attrs:{id:"_2-2-2-插件的运行流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-插件的运行流程"}},[t._v("#")]),t._v(" 2.2.2 插件的运行流程")]),t._v(" "),n("p",[t._v("在执行protoc编译的时候，命令行是这样写的："),n("code",[t._v("protoc -python_out=./ *.proto")]),t._v("，Protobuf原生支持Python所以认识"),n("code",[t._v("-python_out")]),t._v("，这表示把当前目录下所有proto都编译成python。如果我们命令行这样写："),n("code",[t._v("protoc -xxx_out=./ *.proto")]),t._v("，由于不认识xxx，于是"),n("code",[t._v("protoc")]),t._v("会在PATH路径下寻找一个叫做"),n("code",[t._v("protoc-gen-xxx")]),t._v("的可执行文件。而"),n("code",[t._v("protoc-gen-xxx")]),t._v("就是我们要实现的插件。")]),t._v(" "),n("p",[t._v("插件的运行流程如图：")]),t._v(" "),n("ul",[n("li",[t._v("我们只需要关注步骤3.1~3.5，其余步骤是谷歌protoc完成")]),t._v(" "),n("li",[t._v("CodeGeneratorRequest和CodeGeneratorResponse对象定义在"),n("a",{attrs:{href:"https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/compiler/plugin.proto",target:"_blank",rel:"noopener noreferrer"}},[t._v("plugin.proto"),n("OutboundLink")],1),t._v("里面")]),t._v(" "),n("li",[t._v("FileDescriptor代表了一个proto文件，定义在"),n("a",{attrs:{href:"https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/descriptor.proto",target:"_blank",rel:"noopener noreferrer"}},[t._v("descriptor.proto"),n("OutboundLink")],1),t._v("里面")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(356),alt:"image.png"}})]),t._v(" "),n("h4",{attrs:{id:"_2-2-3-插件具体实现代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-插件具体实现代码"}},[t._v("#")]),t._v(" 2.2.3 插件具体实现代码")]),t._v(" "),n("p",[t._v("本章概述就说了插件可以通过多种语言（Python、Java、C#等）实现，这里我们以Python为例。实现涉及到的主要类为：")]),t._v(" "),n("ul",[n("li",[t._v("CodeGeneratorRequest对应："),n("code",[t._v("from google.protobuf.compiler.plugin_pb2 import CodeGeneratorRequest")])]),t._v(" "),n("li",[t._v("CodeGeneratorResponse对应："),n("code",[t._v("from google.protobuf.compiler.plugin_pb2 import CodeGeneratorResponse")])]),t._v(" "),n("li",[t._v("FileDescriptor对应："),n("code",[t._v("from google.protobuf.descriptor import FileDescriptor")])])]),t._v(" "),n("p",[t._v("一个简单的Demo代码如下，将代码命名为"),n("code",[t._v("protoc-gen-hello")]),t._v("，赋予可执行权限，然后放置到"),n("code",[t._v("PATH")]),t._v("路径下：")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/usr/bin/env python3")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("protobuf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compiler "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" plugin_pb2\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.1 读取二进制")]),t._v("\ninput_data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("buffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.2 反序列化")]),t._v("\nreq "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" plugin_pb2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CodeGeneratorRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FromString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.3 根据业务需求具体实现")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# req.proto_file[0]是FileDescriptor类型的对象")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 正常业务肯定要通过req.proto_file[0]读取proto代码的信息，然后根据具体业务需求解析")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 但这段代码只是为了简单演示，就不读取了")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.4 构造CodeGeneratorResponse对象")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下面这段逻辑说明，不管输入的proto如何")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 本插件都会输出aaa.txt和bbb.txt文件，文件内容都是hello")]),t._v("\nresp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" plugin_pb2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CodeGeneratorResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aaa.txt'")]),t._v("\nresp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),t._v("\nresp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bbb.txt'")]),t._v("\nresp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.5 将CodeGeneratorResponse序列化成二进制后打印")]),t._v("\nsys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("buffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SerializeToString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("为了运行这段代码，我们的命令是："),n("code",[t._v("protoc --hello_out=./ *.proto")]),t._v("，这样protoc会去寻找一个叫做"),n("code",[t._v("protoc-gen-hello")]),t._v("的可执行文件。")]),t._v(" "),n("h3",{attrs:{id:"_2-3-方案三：自己编写编译器前端、后端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-方案三：自己编写编译器前端、后端"}},[t._v("#")]),t._v(" 2.3 方案三：自己编写编译器前端、后端")]),t._v(" "),n("p",[t._v("此法风险和难度比较大：")]),t._v(" "),n("ul",[n("li",[t._v("需要开发者熟练掌握编译原理")]),t._v(" "),n("li",[t._v("谷歌并没有对此方案提供任何技术支持")]),t._v(" "),n("li",[t._v("Protobuf有一些隐含语法，这部分并没有在官方文档中说明，让此方案的兼容性得不到保障")])]),t._v(" "),n("p",[t._v("如果有特殊需求才考虑此法：")]),t._v(" "),n("ul",[n("li",[t._v("有proto文件热加载需求，即希望应用能够直接加载proto文件")])]),t._v(" "),n("p",[t._v("目前也有一些开源库使用此方案：")]),t._v(" "),n("ul",[n("li",[t._v("https://github.com/dcodeIO/protobuf.js")])]),t._v(" "),n("h3",{attrs:{id:"_2-4-方案对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-方案对比"}},[t._v("#")]),t._v(" 2.4 方案对比")]),t._v(" "),n("p",[t._v("方案一只能通过C++实现。如果不是遗留项目，方案一没有什么优势。")]),t._v(" "),n("p",[t._v("方案二可选开发语言多样，推荐使用。")]),t._v(" "),n("p",[t._v("方案三难度最大，基本只有特殊需求、学习研究会考虑此法。")]),t._v(" "),n("h2",{attrs:{id:"第三章-protobuf插件开发详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第三章-protobuf插件开发详解"}},[t._v("#")]),t._v(" 第三章 Protobuf插件开发详解")]),t._v(" "),n("p",[t._v("在2.2节中已经介绍了基本内容，因为从Protobuf 3开始这是最常用的方法，所以这里花一个章节的篇幅详细介绍。")]),t._v(" "),n("p",[t._v("本章以Python语言为例编写一个简易的Protobuf插件，该插件的名字是"),n("code",[t._v("protoc-gen-lint")]),t._v("，用来检测proto代码是否有潜在问题。我们知道一个成熟的lint工具检测内容是非常多的，甚至包括英语单词拼写是否正确，但是本章作为教学例子，只做了非常有限的几个功能。")]),t._v(" "),n("p",[t._v("本章例子的检测的内容是：")]),t._v(" "),n("ul",[n("li",[t._v("判断message名是否为驼峰命名法，即不能含有下划线、不能有两个连续大写字母出现")]),t._v(" "),n("li",[t._v("等等")])]),t._v(" "),n("h3",{attrs:{id:"_3-1-代码如下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-代码如下"}},[t._v("#")]),t._v(" 3.1 代码如下")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/usr/bin/env python3")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("protobuf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compiler "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" plugin_pb2\n\ninput_data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("buffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nreq "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" plugin_pb2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CodeGeneratorRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FromString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" plugin_pb2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CodeGeneratorResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" f "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("proto_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    log "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" m "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 判断是否存在下划线")]),t._v("\n            log "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{0}中的{1}不符合驼峰命名法\\n'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 判断是否存在连续的大写字母")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isupper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isupper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    log "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{0}中的{1}不符合驼峰命名法\\n'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" log "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 若确实存在问题，则将报错信息输出到.lint.txt后缀的文件中")]),t._v("\n        resp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        resp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rstrip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.proto'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.lint.txt'")]),t._v("\n        resp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" log\n\nsys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("buffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SerializeToString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"附录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附录"}},[t._v("#")]),t._v(" 附录")]),t._v(" "),n("h3",{attrs:{id:"附录：官方支持语言列表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附录：官方支持语言列表"}},[t._v("#")]),t._v(" 附录：官方支持语言列表")]),t._v(" "),n("h3",{attrs:{id:"附录：供参考的开源项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附录：供参考的开源项目"}},[t._v("#")]),t._v(" 附录：供参考的开源项目")])])}),[],!1,null,null,null);s.default=r.exports}}]);