(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{456:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"小实验：编译、链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小实验：编译、链接"}},[t._v("#")]),t._v(" 小实验：编译、链接")]),t._v(" "),s("h2",{attrs:{id:"编译时链接静态库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译时链接静态库"}},[t._v("#")]),t._v(" 编译时链接静态库")]),t._v(" "),s("p",[t._v("若main.c想要使用外部库中的一些函数、变量，需要将其链接（Link）进来。")]),t._v(" "),s("h3",{attrs:{id:"理论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#理论"}},[t._v("#")]),t._v(" 理论")]),t._v(" "),s("h3",{attrs:{id:"库（library）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#库（library）"}},[t._v("#")]),t._v(" 库（Library）")]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("/usr/lib/")]),t._v("目录下可以找到很多库，文件名形如"),s("code",[t._v("libxxx.so")]),t._v("或"),s("code",[t._v("libxxx.a")]),t._v("，那么这个库的名字就叫xxx。")]),t._v(" "),s("h4",{attrs:{id:"符号（symbol）表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#符号（symbol）表"}},[t._v("#")]),t._v(" 符号（Symbol）表")]),t._v(" "),s("p",[t._v("库和可执行文件都会有符号，在Linux下可以通过"),s("code",[t._v("nm")]),t._v("命令来查看一个文件的符号表。")]),t._v(" "),s("h4",{attrs:{id:"c语言编译、链接过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#c语言编译、链接过程"}},[t._v("#")]),t._v(" C语言编译、链接过程")]),t._v(" "),s("p",[t._v("C代码首先会"),s("code",[t._v("编译")]),t._v("成为机器指令，函数和变量经过编译成为了符号，此时的符号都还没有分配具体的地址，因此是不可执行的。随后需要进行"),s("code",[t._v("链接")]),t._v("，链接会为符号分配地址，链接后得到的就是可执行文件了。\n可以通过编译选项"),s("code",[t._v("gcc -l")]),t._v("链接外部库。")]),t._v(" "),s("h3",{attrs:{id:"实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[t._v("#")]),t._v(" 实践")]),t._v(" "),s("p",[t._v("这个实验主要是体会编译、链接这两个步骤。")]),t._v(" "),s("h4",{attrs:{id:"实验指导"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验指导"}},[t._v("#")]),t._v(" 实验指导")]),t._v(" "),s("p",[t._v("对于这样的一个程序：")]),t._v(" "),s("div",{staticClass:"language-c extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("msg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("实验步骤：")]),t._v(" "),s("ul",[s("li",[t._v("编译但不链接："),s("code",[t._v("gcc -c hello.c -o hello.o")]),t._v("，它会编译"),s("code",[t._v("hello.c")]),t._v("并生成"),s("code",[t._v("hello.o")]),t._v("文件。"),s("code",[t._v("-c")]),t._v("选项告诉"),s("code",[t._v("gcc")]),t._v("只编译不链接。")]),t._v(" "),s("li",[t._v("链接："),s("code",[t._v("gcc hello.o -lc -o hello")]),t._v("，得到可执行文件"),s("code",[t._v("hello")]),t._v("。其中"),s("code",[t._v("-lc")]),t._v("是链接C标准库，"),s("code",[t._v("-lc")]),t._v("的意思是链一个叫做c的库，"),s("code",[t._v("-labc")]),t._v("的意思是链接一个叫做abc的库。")])]),t._v(" "),s("p",[t._v("查看符号表，体会链接前后的差异（链接后符号分配了地址）：")]),t._v(" "),s("ul",[s("li",[t._v("执行"),s("code",[t._v("nm ./hello.o")])]),t._v(" "),s("li",[t._v("执行"),s("code",[t._v("nm ./hello")])])]),t._v(" "),s("h4",{attrs:{id:"实验结果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验结果"}},[t._v("#")]),t._v(" 实验结果")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("hello.o")]),t._v("的符号表：")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("0000000000000000 T _main\n0000000000000048 D _msg\n                 U _printf  # 这个U的意思是undefined，未定义\n")])])]),s("ul",[s("li",[s("code",[t._v("hello")]),t._v("的符号表：")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("0000000100000f50 T _main\n0000000100000fa2 S _msg\n                 U _printf\n")])])]),s("h2",{attrs:{id:"如何创建库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何创建库"}},[t._v("#")]),t._v(" 如何创建库")]),t._v(" "),s("p",[t._v("链接分为动态链接和静态链接。静态库的文件名为"),s("code",[t._v("libxxx.a")]),t._v("，动态库的文件名为"),s("code",[t._v("libxxx.so")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"理论-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#理论-2"}},[t._v("#")]),t._v(" 理论")]),t._v(" "),s("h4",{attrs:{id:"静态库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#静态库"}},[t._v("#")]),t._v(" 静态库")]),t._v(" "),s("p",[t._v("创建名为math的静态库，分编译、打包两个步骤：")]),t._v(" "),s("ul",[s("li",[t._v("第一步，编译，但不链接："),s("code",[t._v("gcc -c infile.c -o outfile.o")])]),t._v(" "),s("li",[t._v("第二步，打包："),s("code",[t._v("ar -rcs libmath.a outfile1.o outfile2.o")])])]),t._v(" "),s("h4",{attrs:{id:"动态库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态库"}},[t._v("#")]),t._v(" 动态库")]),t._v(" "),s("p",[t._v("创建名为math的动态库：")]),t._v(" "),s("ul",[s("li",[t._v("第一步："),s("code",[t._v("gcc -c -fPIC infile.c -o outfile.o")])]),t._v(" "),s("li",[t._v("其中"),s("code",[t._v("-fPIC")]),t._v("意思是生成位置无关码（Position Independent Code）")]),t._v(" "),s("li",[t._v("第二步："),s("code",[t._v("ld -shared -soname libmath.so -o libmath.so outfile1.o outfile2.o")])]),t._v(" "),s("li",[t._v("可能还要配置"),s("code",[t._v("LD_LIBRARY_PATH")]),t._v("环境变量")]),t._v(" "),s("li",[t._v("可能还要执行"),s("code",[t._v("ldconfig")]),t._v("命令")])]),t._v(" "),s("h3",{attrs:{id:"实践-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实践-2"}},[t._v("#")]),t._v(" 实践")]),t._v(" "),s("p",[t._v("为了加深理解，尝试以下实验。")]),t._v(" "),s("h4",{attrs:{id:"实验指导-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验指导-2"}},[t._v("#")]),t._v(" 实验指导")]),t._v(" "),s("p",[t._v("main.c代码如下：")]),t._v(" "),s("div",{staticClass:"language-c extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.c")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%d\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("math.c代码如下：")]),t._v(" "),s("div",{staticClass:"language-c extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("创建动态库的步骤：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("gcc -c -fPIC math.c -o math.o")])]),t._v(" "),s("li",[s("code",[t._v("ld -shared -soname libmath.so -o libmath.so math.o")])]),t._v(" "),s("li",[s("code",[t._v("gcc main.c -L./ -lmath -o main_shared")])]),t._v(" "),s("li",[t._v("运行："),s("code",[t._v("LD_LIBRARY_PATH=$(pwd) ./main_shared")])])]),t._v(" "),s("p",[t._v("创建静态库的步骤：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("gcc -c math.c -o math.o")])]),t._v(" "),s("li",[s("code",[t._v("ar -rcs libmath.a math.o")])]),t._v(" "),s("li",[s("code",[t._v("gcc main.c -L./ -lmath -o main_static")])]),t._v(" "),s("li",[t._v("运行："),s("code",[t._v("./main_static")])])]),t._v(" "),s("p",[t._v("下面体会动态库和静态库的区别：")]),t._v(" "),s("ul",[s("li",[t._v("分别敲"),s("code",[t._v("ldd main_shared")]),t._v("和"),s("code",[t._v("ldd main_static")]),t._v("，体会二者区别")]),t._v(" "),s("li",[t._v("分别敲"),s("code",[t._v("ls -al ./main_shared")]),t._v("和"),s("code",[t._v("ls -al ./main_static")]),t._v("，体会两个文件的大小区别")]),t._v(" "),s("li",[t._v("分别敲"),s("code",[t._v("nm ./main_shared")]),t._v("和"),s("code",[t._v("nm ./main_static")]),t._v("，体会二者符号表的区别，重点关注"),s("code",[t._v("add")]),t._v("符号")]),t._v(" "),s("li",[t._v("删除"),s("code",[t._v("libmath.a")]),t._v("后"),s("code",[t._v("main_static")]),t._v("还能运行，但删除"),s("code",[t._v("libmath.so")]),t._v("后"),s("code",[t._v("main_shared")]),t._v("不能运行了")]),t._v(" "),s("li",[t._v("将"),s("code",[t._v("libmath.so")]),t._v("移动到其它目录后，必须相应更新"),s("code",[t._v("LD_LIBRARY_PATH")]),t._v("才能运行"),s("code",[t._v("main_shared")])])]),t._v(" "),s("p",[t._v("实验注意事项：")]),t._v(" "),s("ul",[s("li",[t._v("如果同时有"),s("code",[t._v("libmath.so")]),t._v("和"),s("code",[t._v("libmath.a")]),t._v("，那么会优先使用"),s("code",[t._v(".so")]),t._v("，所以在做静态库实验时，确保已经删除了"),s("code",[t._v("libmath.so")])])]),t._v(" "),s("h4",{attrs:{id:"实验结果-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验结果-2"}},[t._v("#")]),t._v(" 实验结果")]),t._v(" "),s("p",[s("code",[t._v("main_shared")]),t._v("的符号表大概是这样的，其中"),s("code",[t._v("add")]),t._v("符号是未定义：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("00000000000005a8 T _init\n0000000000000600 T _start\n                 U add\n0000000000201010 b completed.7696\n0000000000201000 W data_start\n")])])]),s("p",[s("code",[t._v("main_static")]),t._v("大概是这样的，其中"),s("code",[t._v("add")]),t._v("符号有定义：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("00000000000004f0 T _init\n0000000000000540 T _start\n0000000000000677 T add\n0000000000201010 b completed.7696\n0000000000201000 W data_start\n")])])]),s("p",[s("code",[t._v("ldd main_shared")]),t._v("比"),s("code",[t._v("ldd main_static")]),t._v("多了一个东西：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# main_shared的结果\n        linux-vdso.so.1 (0x00007fff06f13000)\n        libmath.so => not found\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f7178212000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f7178805000)\n\n# main_static的结果\n        linux-vdso.so.1 (0x00007ffd0bd93000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f8b7c07e000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f8b7c671000)\n")])])]),s("h2",{attrs:{id:"运行时加载动态库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行时加载动态库"}},[t._v("#")]),t._v(" 运行时加载动态库")]),t._v(" "),s("p",[t._v("通过"),s("code",[t._v("dlopen()")]),t._v("在运行时加载动态库，也能做到调用动态库中提供的函数、变量，这比编译时链接要更加灵活。")]),t._v(" "),s("h3",{attrs:{id:"理论-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#理论-3"}},[t._v("#")]),t._v(" 理论")]),t._v(" "),s("p",[s("code",[t._v("dlfcn.h")]),t._v("中定义了一些函数，这些函数不是C标准库的一部分，因此想要用的话必须加上"),s("code",[t._v("-ldl")]),t._v("编译选项：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("void *dlopen(const char *file, int mode);")]),t._v("，返回一个handle")]),t._v(" "),s("li",[s("code",[t._v("void *dlsym(void *handle, const char *symbol_name);")]),t._v("，用于查询符号（即变量或函数）的地址")]),t._v(" "),s("li",[s("code",[t._v("int dlclose(void *handle);")]),t._v("，库调用完后通过此函数关闭库\n"),s("code",[t._v("mode")]),t._v("参数分为：")]),t._v(" "),s("li",[t._v("RTLD_LAZY")]),t._v(" "),s("li",[t._v("RTLD_NOW")]),t._v(" "),s("li",[t._v("RTLD_GLOBAL")]),t._v(" "),s("li",[t._v("RTLD_LOCAL")])]),t._v(" "),s("h3",{attrs:{id:"实践-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实践-3"}},[t._v("#")]),t._v(" 实践")]),t._v(" "),s("p",[t._v("之前我们已经创建了"),s("code",[t._v("libmath.so")]),t._v("这个动态库，下面写一个"),s("code",[t._v("main.c")]),t._v("来调用math库中的add函数。")]),t._v(" "),s("h4",{attrs:{id:"实验指导-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验指导-3"}},[t._v("#")]),t._v(" 实验指导")]),t._v(" "),s("p",[t._v("代码如下：")]),t._v(" "),s("div",{staticClass:"language-c extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<dlfcn.h>")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("add"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("handle "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlopen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./libmath.so"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" RTLD_NOW"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlsym")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"add"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("add "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%d\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("实验步骤：")]),t._v(" "),s("ul",[s("li",[t._v("编译："),s("code",[t._v("gcc main.c -ldl -o main")])]),t._v(" "),s("li",[t._v("运行："),s("code",[t._v("./main")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);