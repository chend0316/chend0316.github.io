(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{499:function(e,t,n){"use strict";n.r(t);var a=n(45),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"node-c-addons"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node-c-addons"}},[e._v("#")]),e._v(" Node C++ Addons")]),e._v(" "),n("p",[e._v("WIP: 限于笔者水平，所以本文内容可能有一些错误。")]),e._v(" "),n("p",[e._v("我们可以基于 V8 API 和 Node.js API 提供的头文件来编写 C++ 代码。不同版本的 Node.js 使用的 V8 引擎版本也是不同的。主要有两个坑点：")]),e._v(" "),n("ul",[n("li",[e._v("V8 和 Node.js 在不同版本提供的函数有所不同，所以要为每一个版本的 Node.js 单独编译一份，有点坑。")]),e._v(" "),n("li",[e._v("更坑的是 V8 API 变动非常频繁，很多变动都不向下兼容，所以有时不仅需要重新编译，而是需要重写代码！")])]),e._v(" "),n("p",[e._v("NAN 提供了一些宏可以判断 V8 版本展开不同的宏，这屏蔽了一部分 V8 API 的变动，缓解了重写代码的问题。但还是需要为每个 V8 版本单独编译。")]),e._v(" "),n("p",[e._v("N-API 封装了一层全新的 API，暴露出一些稳定的 API，保证接口向下兼容。而且只需要一次编译就可以用于不同版本的 Node.js。")]),e._v(" "),n("p",[e._v("总之 NAN 本质上只是一些宏展开，没有提供新接口，在编译阶段屏蔽 V8 API 变动。N-API 则提供了一套全新接口，在运行阶段屏蔽 V8 API 变动。")]),e._v(" "),n("h2",{attrs:{id:"nan-native-abstractions-for-node-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nan-native-abstractions-for-node-js"}},[e._v("#")]),e._v(" NAN (Native abstractions for Node.js)")]),e._v(" "),n("p",[n("code",[e._v("npm install nan")]),e._v("，安装完成后进入 node_modules 目录找一下它提供的头文件，可以看到有很多宏。想要上手写代码的话，还是需要去学习 V8 的那套接口。")]),e._v(" "),n("p",[e._v("因为没有提供新 API，不需要大家学额外的知识。所以"),n("a",{attrs:{href:"https://nodejs.org/api/addons.html#addons_native_abstractions_for_node_js",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.js 官网"),n("OutboundLink")],1),e._v(" 只用了一小段话来介绍这个技术。然后给了一个\n"),n("a",{attrs:{href:"https://github.com/nodejs/nan/tree/HEAD/examples/",target:"_blank",rel:"noopener noreferrer"}},[e._v("demo"),n("OutboundLink")],1),e._v("。")]),e._v(" "),n("h2",{attrs:{id:"n-api-node-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#n-api-node-api"}},[e._v("#")]),e._v(" N-API (Node-API)")]),e._v(" "),n("p",[e._v("虽然不用学 V8 了，但要学很多 "),n("a",{attrs:{href:"https://nodejs.org/api/n-api.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("N-API 的知识"),n("OutboundLink")],1),e._v("。")])])}),[],!1,null,null,null);t.default=o.exports}}]);